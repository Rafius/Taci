<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="assets/favicon.ico">

<title>TAS TACI</title>

<!-- TAS core CSS -->
<link href="css/tas-console.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/theme.css" rel="stylesheet">

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.css" rel="stylesheet">
<!-- Bootstrap theme -->
<link href="css/bootstrap-theme.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="mainBody" style="background-color: #557fa0;">
	<script src="js/jquery-min.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/tas-console.js"></script>

	<div class="row" style="width: 100%;">
		<div id="word" class="col-sm-6">
			<div class="container" style="width: 100%; padding-right: 0px;">
				<header class="clearfix" style="padding: 0px;">
					<h1>Caixer 0019</h1>
				</header>
				<div class="main">
					<ul class="cbp_tmtimeline" id="timeline19">
					</ul>
				</div>
			</div>
		</div>

		<div id="word" class="col-sm-6">
			<div class="container" style="width: 100%;">
				<header class="clearfix" style="padding: 0px;">
					<h1>Caixer 0005</h1>
				</header>
				<div class="main">
					<ul class="cbp_tmtimeline" id="timeline5">
					</ul>
				</div>
			</div>
		</div>
	</div>
	<script>
		var primerarranc = true;

		inicia();
		function inicia() {
			connectToML();
			mostraEnServei(false, 05);
		}
		function connectToML() {
			var url = "ws://" + getServer() + ":1716/component";
			console.log(url);
			connectTo(url);
		}
		function afterClose() {
			if (connected) {
				mostraEnServei(false, 19);
				connected = false;
				connectToML();
			}
		}
		function mostraEnServei(really, caixer) {
			var result = 1;
			var frase = "CAIXER FORA DE SERVEI";
			if (really) {
				result = 0;
				frase = "CAIXER EN SERVEI";
			}
			noutimeline(frase, new Date().toLocaleTimeString('es-ES', {
				hour : "numeric",
				minute : "numeric",
				second : "numeric"
			}), true, 0, result, caixer);
		}
		function afterError() {
			console.log("primerarranc: " + primerarranc)
			if (primerarranc) {
				mostraEnServei(false, 19);
				primerarranc = false;
			}
			setTimeout(function() {
				connectToML();
			}, 5000);
		}
		function afterOpen() {
			connected = true;
			primerarranc = false;
			setTimeout(function() {
				setMessage('{"component":"taciPoc", "request":{"method":"doConnect","fields":[{"type": "CALLBACK","className": "com.caixabank.tas.ml.component.debug.tacipoc.ITaciPocCallback"}]}}');
				sendMessage();
			}, 3000);
			mostraEnServei(true, 19);
		}
		function messageReceived(res) {
			if (res.response.method == "doConnect") {
				if (res.type == "EVENT") {
					console.log("event amb " + res.response.fields[0].value + " " + res.response.fields[1].value + " " + res.response.fields[2].value);
					noutimeline(res.response.fields[0].value, res.response.fields[1].value, res.response.fields[2].value, res.response.fields[3].value, res.response.fields[4].value, 19);
				} else {
				}
			}
		}
		function noutimeline(frase, hora, marca, level, result, caixer) {
			var elli = document.createElement("li");
			var eldivmarca = document.createElement("div");
			eldivmarca.classList.add("cbp_tmicon");
			var eldiv = document.createElement("div");
			eldiv.classList.add("cbp_tmlabel");
			eldiv.classList.add("cbp_tmlabel_level_" + level);
			eldiv.classList.add("cbp_tmlabel_result_" + result);
			var elspan = document.createElement("span");
			elspan.innerHTML = hora;
			var elh3 = document.createElement("h3");
			elh3.innerHTML = frase;
			eldiv.appendChild(elspan);
			eldiv.appendChild(elh3);
			if (marca != null && marca == true) {
				elli.appendChild(eldivmarca);
			}
			elli.appendChild(eldiv);
			var list = document.getElementById("timeline" + caixer);
			list.insertBefore(elli, list.childNodes[0]);
		}
	</script>
</body>
</html>