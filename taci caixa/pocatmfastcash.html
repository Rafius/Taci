<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="assets/favicon.ico">

<title>TAS FastCash ATM</title>

<!-- TAS core CSS -->
<link href="css/tas-console.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/theme.css" rel="stylesheet">

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.css" rel="stylesheet">
<!-- Bootstrap theme -->
<link href="css/bootstrap-theme.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="mainBody">

	<!--<script src="webLocal/js/external/jquery/jquery.js"></script>-->
	<script src="js/tas-console.js"></script>
	<script src="js/jquery-min.js"></script>
	<script src="js/jquery-ui.min.js"></script>

	<div align="center">
		<div class="col-md-12" align="center" style="margin: 0px 0px 0px 0px;">
			<img src="assets/imagin.jpg" style="max-width: calc(100%);">
		</div>
	</div>
	<div id="title">
		<div class="col-md-12" align="center" style="margin: 150px 0px 0px 0px;">
			<font family="'Lucida Sans Unicode', 'Lucida Grande', sans-serif" size='24px' color='009EDF'>
				<b>
					Benvingut a
					<br>
					<i>FastCash</i>
				</b>
			</font>
		</div>
	</div>

	<div id="instructions" class="hidden">
		<div class="col-md-12" align="center" style="margin: 30px;">
			<font family="'Lucida Sans Unicode', 'Lucida Grande', sans-serif" size='24px' color='009EDF'>
				<b>
					Valida l'emprempta al m√≤vil
					<br>
					per obtenir el teu
					<i>FastCash</i>
				</b>
			</font>
		</div>
	</div>

	<div id="finger" align="center" class="hidden">
		<div class="col-md-12" align="center" style="margin: 30px;">
			<img src="assets/fingeratm.png" style="width: 25%;">
		</div>
	</div>

	<div id="spinner" class="hidden">
		<div class="col-md-12" align="center" style="margin: 150px 0px 0px 0px;">
			<span class="glyphicon glyphicon-refresh spinning"></span>
		</div>
	</div>

	<div id="takemoney" class="hidden">
		<div class="col-md-12" align="center" style="margin: 30px;">
			<font family="'Lucida Sans Unicode', 'Lucida Grande', sans-serif" size='24px' color='009EDF'>
				<b>Agafa els diners</b>
			</font>
		</div>
	</div>

	<div id="dispenser" align="center" class="hidden">
		<div class="col-md-12" align="center" style="margin: 30px;">
			<img src="assets/dispenser.png" style="width: 20%;">
		</div>
	</div>

	<script>
		var executionNumber = "0";
		connectToML();
		function connectToML() {
			connectTo("ws://localhost:1716/component");
		}
		function afterError() {
			setTimeout(function() {
				connectToML();
			}, 5000);
		}
		function afterOpen() {
			setMessage('{"component":"fastCashPoc", "request":{"method":"startComunnication","fields":[{"type":"CALLBACK","className":"com.caixabank.tas.ml.component.debug.fastcashpoc.IPocCallback"}]}}');
			sendMessage();
		}
		function messageReceived(res) {
			console.log('messageReceived in pocatm');
			console.log("yeah: " + res.response.method);

			if (res.response.method == "startComunnication") {
				var detail = res.response.fields[0].value;
				console.log("detail: " + detail);
				if (detail == "50" || detail == "20") {
					executionNumber = detail;
					emulateFingerCheck();
				}
				if (detail == "executed") {
					takeMoni();
				}
				if (detail == "finaliced") {
					goToWait();
				}
			}
		}
		function emulateFingerCheck() {
			//if (!$("#title").hasClass("hidden")) {
			hideAll();
			$("#instructions").removeClass("hidden");
			$("#finger").removeClass("hidden");
			startExecution();
			//}
		}
		function startExecution() {
			setTimeout(function() {
				hideAll();
				$("#spinner").removeClass("hidden");
				setMessage('{"component":"fastCashPoc", "request":{"method":"executePocAttemp","fields":[{"value":"' + executionNumber + '"}]}}');
				sendMessage();
			}, 5000);
		}
		function takeMoni() {
			hideAll();
			$("#takemoney").removeClass("hidden");
			$("#dispenser").removeClass("hidden");
			setMessage('{"component":"fastCashPoc", "request":{"method":"finalicePocAttemp","fields":[]}}');
			sendMessage();
		}
		function goToWait() {
			hideAll();
			$("#title").removeClass("hidden");
		}
		function hideAll() {
			$("#title").addClass("hidden");
			$("#instructions").addClass("hidden");
			$("#finger").addClass("hidden");
			$("#spinner").addClass("hidden");
			$("#takemoney").addClass("hidden");
			$("#dispenser").addClass("hidden");
		}
	</script>

</body>
</html>