<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="assets/favicon.ico">

<title>TAS TestConsole suite</title>

<!-- TAS core CSS -->
<link href="css/tas-console.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/theme.css" rel="stylesheet">

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.css" rel="stylesheet">
<!-- Bootstrap theme -->
<link href="css/bootstrap-theme.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="devicesBody">

	<!-- Main jumbotron for a primary marketing message or call to action -->
	<div class="page-header">
		<h3>DEVICES TEST CONSOLE</h3>
	</div>

	<div class="row" style="width: 100%">
		<div class="col-sm-6">
			<label for="url">URL</label>
			<input type="text" id="url" style="width: 90%" value="ws://localhost:1718/device" />
		</div>
		<div class="col-sm-6">
			<button class="btn pull-right btn-sm btn-primary" style="width: 31%; margin: -3px 0px 0px 0px;" id="clearLog" onclick="clearLog()">Clear</button>
			<button class="btn pull-right btn-sm btn-primary" style="width: 31%; margin: -3px 5px 0px 0px;" id="disconnect" onclick="disconnect()">Disconnect</button>
			<button class="btn pull-right btn-sm btn-primary" style="width: 31%; margin: -3px 5px 0px 0px;" id="connect" onclick="connect()">Connect</button>
		</div>
	</div>

	<br />
	<div class="row" style="width: 100%">
		<div class="col-sm-12">
			<label for="mensaje">Message:</label>
			<br />
			<input type="text" id="mensaje" onchange="setMessage(this.value)" style="width: 80%" />
			<button class="btn pull-right btn-sm btn-success" style="width: 15%; margin-top: -3px;" id="sendMessage" onclick="sendMessage()">Send message</button>
		</div>
	</div>
	<hr />
	<div>
		<div id="boxesColumn" class="col-sm-4" style="padding: 0px">
			<div style="width: 100%">
				<div class="list-group">
					<a class="list-group-item active">
						<strong>Common commands</strong>
					</a>
					<div class='list-group-item'>
						<div style="float: left; width: 52%;">
							<div class="list-group" style="overflow-y: scroll; height: 190px; padding: 0px;" id="devicesListGroup"></div>
						</div>
						<div style="margin-left: 55%;">
							<div>
								<button class="btn btn-sm btn-success" style="width: 100%; margin: 5px;" onclick="sendAction('getDeviceInfo')">getDeviceInfo</button>
								<button class="btn btn-sm btn-success" style="width: 100%; margin: 5px;" onclick="sendAction('getRawData')">getRawData</button>
								<button class="btn btn-sm btn-success" style="width: 100%; margin: 5px;" onclick="sendAction('recover')">recover</button>
								<button class="btn btn-sm btn-success" style="width: 100%; margin: 5px;" onclick="sendAction('addInfoObserver')">addInfoObserver</button>
								<button class="btn btn-sm btn-success" style="width: 100%; margin: 5px;" onclick="sendAction('removeInfoObserver')">removeInfoObserver</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div style="width: 100%">
				<div class="list-group">
					<a class="list-group-item active">
						<strong>Register</strong>
					</a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));"
						data-message='{"header" : {"idRequest" : "greeting" }, "component" : "greetingDevice", "request" : { "method" : "addInfoObserver", "fields" : [{ "value" : "deviceManager" }, {"type" : "CALLBACK","className" : "com.caixabank.tas.lowinterface.common.device.IDeviceCallback"}]}}'> register
						greetings status device </a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));" data-message='{ "header" : { "idRequest" : "greeting" }, "component" : "greetingDevice", "request" : { "method" : "removeInfoObserver", "fields" : [{ "value" : "deviceManager" }]}}'>
						unregister greetings status device </a>

				</div>
			</div>
			<div style="width: 100%">
				<div class="list-group">
					<a class="list-group-item active">
						<strong>Greetings</strong>
					</a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));" data-message='{"component":"greetingDevice", "request":{"method":"incrementCounter","fields":[{"value":"holly"},{"className":"java.lang.Integer","value":"1"}]}}'> test greeting device </a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));"
						data-message='{"header":{"idRequest":"greeting"},"component":"greetingDevice", "request":{"method":"incrementCounter","fields":[{"value":"holly"},{"className":"java.lang.Integer","value":"1"}]}}'> test greeting device --SECURE-- </a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));"
						data-message='{"header":{"idRequest":"greeting"},"component":"greetingDevice", "request":{"method":"incrementCounterNTimes","fields":[{"value":"holly"},{"className":"java.lang.Integer","value":"1"},{"className":"java.lang.Integer","value":"10"},{"type":"CALLBACK","className":"com.caixabank.tas.lowinterface.greeting.device.IGreetingDeviceCallback"}]}}'>
						test greeting device N times </a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));" data-message='{"header" : { "idRequest" : "greeting" }, "component" : "greetingDevice", "request" : { "method" : "clearCounter", "fields" : [{ "value" : "holly" } ]}}'> clear greeting
						counter</a>

				</div>
			</div>
			<div style="width: 100%">
				<div class="list-group">
					<a class="list-group-item active">
						<strong>System</strong>
					</a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));"
						data-message='{"component":"systemDevice", "request":{"method":"systemMonitor","fields":[{"className":"java.lang.Integer","value":"30"},{"type":"CALLBACK","className":"com.caixabank.tas.lowinterface.system.device.IMonitorCallback"}]}}'> system monitor</a>
					<a href="#" type="radio" class='list-group-item' onclick="setMessage(this.getAttribute('data-message'));"
						data-message='{"component":"systemDevice", "request":{"method":"processMonitor","fields":[{"className":"java.lang.Integer","value":"30"},{"value":"java.exe"},{"value":"-DVMNAME=BASIC"},{"type":"CALLBACK","className":"com.caixabank.tas.lowinterface.system.device.IMonitorCallback"}]}}'>
						process monitor</a>
				</div>
			</div>
		</div>
		<div class="col-sm-8">
			<div style="border: 1px solid lightgray;">
				<div class="logAreaCSS" id="logArea" style="height: 800px;"></div>
			</div>
		</div>
	</div>
	<script src="js/jquery-min.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/tas-console.js"></script>

	<script>
		var device = 'sensors';
		document.getElementById('url').value = 'ws://' + getServer() + ':1718/device';
		addList();
		function addList() {
			var papar = document.getElementById("devicesListGroup");

			for (i = 0; i < devicesList.length; i++) {
				var element = document.createElement('a');
				element.setAttribute("href", "#");
				element.setAttribute("id", devicesList[i]);
				element.setAttribute("onclick", "changeKey('" + devicesList[i] + "')");
				element.className = 'list-group-item item-device';
				element.innerHTML = devicesList[i];
				papar.appendChild(element);
			}
		}
		function sendAction(action) {
			if (action == "removeInfoObserver") {
				setMessage('{"header" : {"idRequest" : "testConsole" }, "component" : "' + device + 'Device", "request" : { "method" : "' + action + '", "fields" : [{ "value" : "deviceManager" }]}}');
			} else if (action == "addInfoObserver") {
				setMessage('{"header" : {"idRequest" : "testConsole" }, "component" : "' + device + 'Device", "request" : { "method" : "' + action + '", "fields" : [{ "value" : "deviceManager" }, {"type" : "CALLBACK","className" : "com.caixabank.tas.lowinterface.common.device.IDeviceCallback"}]}}');
			} else {
				setMessage('{"header" : {"idRequest" : "testConsole" }, "component" : "' + device + 'Device", "request" : { "method" : "' + action + '", "fields" : []}}');
			}
			sendMessage();
		}
		function changeKey(key) {
			device = key;
			var list = document.getElementsByClassName("item-device");
			for (var i = 0; i < list.length; i++) {
				document.getElementById(list[i].id).setAttribute('class', 'list-group-item item-device');
			}
			document.getElementById(key).setAttribute('class', 'list-group-item item-device list-group-item-warning');
		}
		function prepareToShow(){
			adjustSizes();
		}
		function adjustSizes() {
			var traceBox = document.getElementById('logArea');
			var theTop = traceBox.getBoundingClientRect().top;
			var theBottom = document.getElementById('boxesColumn').getBoundingClientRect().bottom;
			console.log('top: ' + theTop);
			console.log('bottom: ' + theBottom);
			traceBox.setAttribute("style", "height: " + (theBottom - theTop - 20) + "px;");
			parent.document.getElementById('divdevices').setAttribute('height', theBottom + 'px')
		}
	</script>
</body>
</html>
