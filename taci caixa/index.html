<!DOCTYPE html>
<html lang="en" style="overflow-y: scroll;">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="assets/favicon.ico">

<title>TAS TestConsole suite</title>

<!-- TAS core CSS -->
<link href="css/tas-console.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/theme.css" rel="stylesheet">

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.css" rel="stylesheet">
<!-- Bootstrap theme -->
<link href="css/bootstrap-theme.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="mainBody" style="padding-top: 0px;">

	<!--<script src="webLocal/js/external/jquery/jquery.js"></script>-->
	<script src="js/tas-console.js"></script>
	<script src="js/jquery-min.js"></script>
	<script src="js/jquery-ui.min.js"></script>

	<!-- Fixed navbar -->
	<nav class="navbar navbar-inverse navbar-fixed-top" style="margin-bottom: 0px;">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">
					<img style="width: 32px; height: 25px" src="assets/tas.png" class="img-responsive" alt="TAS" onclick="doConnections()">
				</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li id="tagcorecontrol" class='active'>
						<a href="javascript:changepage('corecontrol')">CoreCtrl</a>
					</li>
					<li id="tagexecution">
						<a href="javascript:changepage('execution')">Execute</a>
					</li>
					<li id="tagdevmonitor">
						<a href="javascript:changepage('devmonitor')" id="namedevmon">DevMonitor</a>
					</li>
					<li id="tagparams">
						<a href="javascript:changepage('params')" id="nameparams">Parameters</a>
					</li>
					<li id="tagalbeniz">
						<a href="javascript:changepage('albeniz')">Basic</a>
					</li>
					<li id="tagcomponents">
						<a href="javascript:changepage('components')" id="nameml">Components</a>
					</li>
					<li id="tagdevices">
						<a href="javascript:changepage('devices')" id="namedl">Devices</a>
					</li>
					<li id="tagjudas">
						<a href="javascript:changepage('judas')">Judas</a>
					</li>
					<li id="tagjudasserver">
						<a href="javascript:changepage('judasserver')">JServer</a>
					</li>
					<li id="tagmassives">
						<a href="javascript:changepage('massives')">Massives</a>
					</li>
					<li id="tagcamera">
						<a href="javascript:changepage('camera')">Camera</a>
					</li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>

	<div id="subpagina" class="container theme-showcase visible" role="main">
		<iframe id="divcorecontrol" style="overflow: auto;" class="visible" frameBorder="0" src="corecontrol.html" type="text/html" width="100%" height="10000px"></iframe>
		<iframe id="divexecution" style="overflow: auto;" class="hidden" frameBorder="0" src="execution.html" type="text/html" width="100%" height="705px"></iframe>
		<iframe id="divdevmonitor" style="overflow: auto;" class="hidden" frameBorder="0" src="devmonitor.html" type="text/html" width="100%" height="705px"></iframe>
		<iframe id="divalbeniz" style="overflow: auto;" class="hidden" frameBorder="0" src="albeniz.html" width="100%" height="10000px"></iframe>
		<iframe id="divcomponents" style="overflow: auto;" class="hidden" frameBorder="0" src="components.html" type="text/html" width="100%" height="10000px"></iframe>
		<iframe id="divdevices" style="overflow: auto;" class="hidden" frameBorder="0" src="devices.html" type="text/html" width="100%" height="1400px"></iframe>
		<iframe id="divjudas" style="overflow: auto;" class="hidden" frameBorder="0" src="judas.html" type="text/html" width="100%" height="10000px"></iframe>
		<iframe id="divparams" style="overflow: auto;" class="hidden" frameBorder="0" src="params.html" type="text/html" width="100%" height="2000px"></iframe>
		<iframe id="divcamera" style="overflow: auto;" class="hidden" frameBorder="0" src="camera.html" type="text/html" width="100%" height="2000px"></iframe>
		<iframe id="divjudasserver" style="overflow: auto;" class="hidden" frameBorder="0" src="judasserver.html" type="text/html" width="100%" height="10000px"></iframe>
		<iframe id="divmassives" style="overflow: auto;" class="hidden" frameBorder="0" src="massives.html" type="text/html" width="100%" height="10000px"></iframe>
	</div>

	<!-- /container -->
	<script>
		var lastdivactive = "divcorecontrol";
		var lasttagactive = "tagcorecontrol";

		var urlBA = 'ws://' + getServer() + ':1714/orchestrator';
		var urlML = 'ws://' + getServer() + ':1716/component';
		var urlDL = 'ws://' + getServer() + ':1718/device';
		var urlJD = 'ws://' + getServer() + ':1720/versioncontrol';

		var urls = [ urlBA, urlML, urlDL, urlJD ];
		var wsks = [];

		doConnections();
		$(window).resize(checkSize());
		
		function checkSize() {
			console.log($(window).width() + " " + $(window).height());
			var wi = $(window).width();
			if (wi > 1200) {
				$("#nameparams").html("Parameters");
				$("#namedevmon").html("DevMonitor");
				$("#nameml").html("Components");
				$("#namedl").html("Devices");
			} else {
				$("#nameparams").html("Params");
				$("#namedevmon").html("DevMon");
				$("#nameml").html("ML");
				$("#namedl").html("DL");
			}
			try {
				document.getElementById(lastdivactive).contentWindow.prepareToShow();
			} catch (err) {
				//never mind, just trying if exist
			}
		}
		
		function doConnections() {
			setTimeout("reallyDoConnections()", 2000);
		}

		function reallyDoConnections() {
			wsks[0] = connectToWS(urls[0], wsks[0]);
		}
		function finishConnections() {
			for (var i = 1; i < 4; i++) {
				wsks[i] = connectToWS(urls[i], wsks[i]);
			}
		}

		changepage('corecontrol');

		function changepage(name) {
			var objTag = document.getElementById(lastdivactive);
			if (objTag != null) {
				objTag.setAttribute('class', 'hidden');
			}
			lastdivactive = "div" + name;
			objTag = document.getElementById(lastdivactive);
			if (objTag != null) {
				objTag.setAttribute('class', 'visible');
			}
			var mainBody = parent.document.getElementById('mainBody');
			var theBottom = parent.window.innerHeight;
			objTag.setAttribute('height', (theBottom - 70) + 'px');
			objTag = document.getElementById(lasttagactive);
			if (objTag != null) {
				objTag.setAttribute('class', null);
			}
			lasttagactive = "tag" + name;
			objTag = document.getElementById(lasttagactive);
			if (objTag != null) {
				objTag.setAttribute('class', 'active');
			}
			try {
				document.getElementById(lastdivactive).contentWindow.prepareToShow();
			} catch (err) {
				//never mind, just trying if exist
			}
		}

		function afterOpen(currentWS) {
			checkSize();
			if (currentWS == wsks[0]) {
				var tmpMsg = '{"header":{"idRequest":"testConsole"},"component":"localTestConsole", "request":{"method":"getURLS","fields":[{"value":"';
				tmpMsg += urlBA;
				tmpMsg += '"}]}}';
				sendMessageWS(currentWS, tmpMsg);
			}
		}

		function takeMessage(message) {
			try {
				document.getElementById('divexecution').contentWindow.takeMessage(message);
			} catch (err) {
			}
		}

		function messageReceived(res) {
			console.log('messageReceived in index');
			if (res.component == 'localTestConsole') {
				urlBA = res.response.fields[0].value[0];
				urlML = res.response.fields[0].value[1];
				urlDL = res.response.fields[0].value[2];
				urlJD = res.response.fields[0].value[3];
				urls = [ urlBA, urlML, urlDL, urlJD ];
				console.log(urlBA + " " + urlML + " " + urlDL + " " + urlJD + " ");
				setTimeout(function() {
					try {
						document.getElementById('divexecution').contentWindow.doInit();
					} catch (err) {
						console.log("Error " + err + " in messageReceived " + res)
					}
				}, 1000);
				finishConnections();
			}
			try {
				document.getElementById('divexecution').contentWindow.messageReceived(res);
				document.getElementById('divdevmonitor').contentWindow.messageReceived(res);
				document.getElementById('divparams').contentWindow.messageReceived(res);
			} catch (err) {
				//never mind, just trying if exist
			}
		}
	</script>

</body>
</html>